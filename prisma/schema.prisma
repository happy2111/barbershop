generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model specialist {
  id           Int     @id @default(autoincrement()) @map("id")
  name         String  @map("name")
  phone        String  @unique @map("phone")
  password     String  @map("password")
  role         Role    @default(SPECIALIST) @map("role")
  photo        String? @map("photo")
  description  String? @map("description")
  skills       String? @map("skills")
  refreshToken String? @map("refresh_token")

  schedules schedule[]
  bookings  booking[]
  services  specialist_service[]

  @@map("specialists")
}

model service_category {
  id       Int       @id @default(autoincrement()) @map("id")
  name     String    @unique @map("name")
  services service[]

  @@map("service_categories")
}

model service {
  id           Int                  @id @default(autoincrement()) @map("id")
  name         String               @map("name")
  price        Float                @map("price")
  duration_min Int                  @map("duration_min")
  categoryId   Int                  @map("category_id")
  photo        String?              @map("photo")
  category     service_category     @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  bookings     booking[]
  specialists  specialist_service[]

  @@map("services")
}

model specialist_service {
  id           Int        @id @default(autoincrement()) @map("id")
  specialistId Int        @map("specialist_id")
  serviceId    Int        @map("service_id")
  specialist   specialist @relation(fields: [specialistId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  service      service    @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([specialistId, serviceId])
  @@map("specialist_services")
}

model client {
  id       Int       @id @default(autoincrement()) @map("id")
  name     String?   @map("name")
  phone    String    @unique @map("phone")
  bookings booking[]

  @@map("clients")
}

model schedule {
  id           Int        @id @default(autoincrement()) @map("id")
  specialistId Int        @map("specialist_id")
  day_of_week  Int        @map("day_of_week")
  start_time   String     @map("start_time")
  end_time     String     @map("end_time")
  specialist   specialist @relation(fields: [specialistId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([specialistId, day_of_week])
  @@map("schedules")
}

model booking {
  id           Int           @id @default(autoincrement()) @map("id")
  clientId     Int           @map("client_id")
  specialistId Int           @map("specialist_id")
  serviceId    Int           @map("service_id")
  date         DateTime      @map("date")
  start_time   String        @map("start_time")
  end_time     String        @map("end_time")
  status       BookingStatus @default(PENDING) @map("status")

  client     client     @relation(fields: [clientId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  specialist specialist @relation(fields: [specialistId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  service    service    @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum Role {
  ADMIN
  SPECIALIST
}
